---
title: "Распознавание и разметка части книги Михаила Булгакова «Мастер и Маргарита»"
---
```{r setup, include=FALSE}
library(qpdf)
library(tesseract)
library(pdftools)
library(tesseractgt)
library(magick)
library(tidyverse)
library(stringr)
```

В качестве отсканированного текста возьмем книгу Михаила Булгаков [«Мастер и Маргарита»](https://www.bulgakov.ru/pdf/Master-i-Margarita.pdf), Москва 1984 г

*Текст печатается в последней прижизненной редакции (рукописи хранятся в рукописном отделе Государственной библиотеки СССР имени В. И. Ленина), а также с исправлениями и дополнениями, сделанными под диктовку писателя его женой,
Е. С. Булгаковой.*

1. Выделим 12 страниц из всей книги (с 9 по 20)
2. Скачаем предобученную модель для русского языка
3. С помощью пакета {tesseract} распознаем текст и сохраним его в файл mmrasp.txt

4. Затем убрали перенос слов, строки с числами, строки, состоящие из двух символов, первый из которых т или Т (это номера страниц) с помощью пакета {tidyverse}, результат положили в файл mmrasp_clean.txt

5.

```{r}
  my_files <- list.files( pattern = "pdf", full.names = TRUE)
  
  mf <- my_files
  #pdf_subset(input = mf,
  #          output = "./mm921.pdf",
   #         pages = 9:20)
  #tesseract_download("rus")
  #tesseract_info()$available
  text3 <- pdf_ocr_text("./mm921.pdf", 
                        language = "rus")
  writeLines(text3, con = "./mmrasp.txt")
  text_clean <- text3 %>%
  paste(collapse = "\n") %>%
  str_replace_all("-\\s*\\n\\s*", "") %>%
  str_split("\n") %>%
  unlist() %>%
  discard(~ str_detect(.x, "^\\d+$")) %>%
  discard(~ str_detect(.x, "^[Тт].$")) %>%
  str_trim() %>%
  discard(~ .x == "")
  writeLines(text_clean, con = "./mmrasp_clean.txt")

```

