[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Распознавание и разметка части книги Михаила Булгакова «Мастер и Маргарита»",
    "section": "",
    "text": "В качестве отсканированного текста возьмем книгу Михаила Булгаков «Мастер и Маргарита», Москва 1984 г\nТекст печатается в последней прижизненной редакции (рукописи хранятся в рукописном отделе Государственной библиотеки СССР имени В. И. Ленина), а также с исправлениями и дополнениями, сделанными под диктовку писателя его женой, Е. С. Булгаковой.\n\nВыделим 12 страниц из всей книги (с 9 по 20)\nСкачаем предобученную модель для русского языка\nС помощью пакета {tesseract} распознаем текст и сохраним его в файл mmrasp.txt\nЗатем уберём (1) перенос слов, (2) строки с числами, (3) строки, состоящие из двух символов, первый из которых т или Т (это номера страниц) с помощью пакета {tidyverse}, результат положим в файл mmrasp_clean.txt\nРазметим текст согласно схеме TEI с помощью LLM, результат сохраним в test.xlm\n\n\n  my_files &lt;- list.files( pattern = \"pdf\", full.names = TRUE)\n  \n  mf &lt;- my_files\n  #1\n  #pdf_subset(input = mf,\n  #          output = \"./mm921.pdf\",\n   #         pages = 9:20)\n  #2\n  #tesseract_download(\"rus\")\n  #tesseract_info()$available\n  #3\n  text3 &lt;- pdf_ocr_text(\"./mm921.pdf\", \n                        language = \"rus\")\n\nConverting page 1 to mm921_1.png... done!\nConverting page 2 to mm921_2.png... done!\nConverting page 3 to mm921_3.png... done!\nConverting page 4 to mm921_4.png... done!\nConverting page 5 to mm921_5.png... done!\nConverting page 6 to mm921_6.png... done!\nConverting page 7 to mm921_7.png... done!\nConverting page 8 to mm921_8.png... done!\nConverting page 9 to mm921_9.png... done!\nConverting page 10 to mm921_10.png... done!\nConverting page 11 to mm921_11.png... done!\nConverting page 12 to mm921_12.png... done!\n\n  #4.1\n  writeLines(text3, con = \"./mmrasp.txt\")\n  text_clean &lt;- text3 %&gt;%\n  paste(collapse = \"\\n\") %&gt;%\n  str_replace_all(\"-\\\\s*\\\\n\\\\s*\", \"\") %&gt;%\n  str_split(\"\\n\") %&gt;%\n  unlist() %&gt;%\n  #4.2\n  discard(~ str_detect(.x, \"^\\\\d+$\")) %&gt;%\n  #4.3\n  discard(~ str_detect(.x, \"^[Тт].$\")) %&gt;%\n  str_trim() %&gt;%\n  discard(~ .x == \"\")\n  writeLines(text_clean, con = \"./mmrasp_clean.txt\")\n#5\nSys.setenv(OPENROUTER_API_KEY = \"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\")\nsystem_prompt &lt;- \"\nYou are an expert TEI encoder specializing in Russian literary texts.\n\nCRITICAL RULES:\n1. Preserve the original text EXACTLY — no spelling corrections, no normalization\n2. Maintain original punctuation, capitalization, and line breaks\n3. Do not modernize language\n4. Output ONLY valid TEI XML\n\nTAGGING GUIDELINES:\n- Wrap every paragraph in &lt;p&gt;\n- Tag personal names with &lt;persName&gt;\n- Tag dates and temporal expressions with &lt;date&gt;\n- Tag chapter titles with &lt;head&gt;\n- Tag geographic references with &lt;place&gt;\n  * Cities: &lt;place type='city'&gt;Москва&lt;/place&gt;\n  * Streets and urban locations: &lt;place type='street'&gt;Садовая&lt;/place&gt;\n  * Parks and squares: &lt;place type='park'&gt;Патриаршие пруды&lt;/place&gt;\n  * Regions: &lt;place type='region'&gt;Сибирь&lt;/place&gt;\n  * Use type='fictional' for imaginary places\n\nRETURN FORMAT:\nReturn only the text with added TEI tags, no additional commentary.\nDo not add explanations, comments, or metadata.\n\"\ninput_text &lt;- paste(text_clean, collapse = \"\\n\")\n\nuser_prompt &lt;- input_text\n\nchat &lt;- chat_openrouter(\n  system_prompt = system_prompt,\n  api_key = Sys.getenv(\"OPENROUTER_API_KEY\"),\n  model = \"openai/gpt-oss-20b:free\", \n  echo = FALSE\n)\n\nWarning: The `api_key` argument of `chat_openrouter()` is deprecated as of ellmer 0.4.0.\nℹ Please use the `credentials` argument instead.\n\nresult &lt;- chat$chat(user_prompt)\nresult &lt;- paste(\"&lt;text&gt;\\n\", result, \"\\n&lt;/text&gt;\")\nwrite_lines(result, file = \"test.xml\")\n\n\nПолучился такой текст\n\n\n\n [1] \"&lt;text&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n [2] \" &lt;TEI&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n [3] \"  &lt;text&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \n [4] \"    &lt;body&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \n [5] \"      &lt;head&gt;ГЛАВА 1&lt;/head&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \n [6] \"      &lt;p&gt;… Так кто ж ты, наконеи?&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \n [7] \"      &lt;p&gt;— Я - часть той силы,&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \n [8] \"      &lt;p&gt;чио вечно хочет&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \n [9] \"      &lt;p&gt;зла и вечно совершает благо.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \n[10] \"      &lt;p&gt;Гете, «Фауст»&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \n[11] \"      &lt;p&gt;Никогда не разговаривайте с неизвестными&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \n[12] \"      &lt;p&gt;Однажды весною, в час небывало жаркого заката, в &lt;place type='city'&gt;Москва&lt;/place&gt;,&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \n[13] \"      &lt;p&gt;на &lt;place type='park'&gt;Патриаршие пруды&lt;/place&gt;, появились два гражданина. Первый&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \n[14] \"      &lt;p&gt;из них, одетый в летнюю серенькую пару, был маленького роста, упитан, лыс, свою приличную шляпу пирожком нес в руке,&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      \n[15] \"      &lt;p&gt;а на хорошо выбритом лице его помещались сверхъестественных размеров очки в черной роговой оправе. Второй - плечистый, рыжеватый, вихрастый молодой человек в заломленной&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n[16] \"      &lt;p&gt;на затылок клетчатой кепке - был в ковбойке, жеваных белых&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \n[17] \"      &lt;p&gt;брюках и в черных тапочках.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \n[18] \"      &lt;p&gt;Первый был не кто иной, как &lt;persName&gt;Михаил Александрович&lt;/persName&gt; &lt;persName&gt;Берлиоз&lt;/persName&gt;, председатель правления одной из крупнейших московских литературных ассоциаций, сокращенно именуемой&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                   \n[19] \"      &lt;p&gt;МАССОЛИТ, и редактор толстого художественного журнала, а молодой спутник его - поэт &lt;persName&gt;Иван Николаевич&lt;/persName&gt; &lt;persName&gt;Понырев&lt;/persName&gt;, пишущий под псевдонимом Бездомный.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                 \n[20] \"      &lt;p&gt;Попав в тень чуть зеленеющих лип, писатели первым долгом бросились к пестро раскрашенной будочке с надписью «Пиво и воды».&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \n[21] \"      &lt;p&gt;Да, следует отметить первую странность этого страшного&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \n[22] \"      &lt;p&gt;майского вечера. Не только у будочки, но и во всей аллее,&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n[23] \"      &lt;p&gt;параллельной Малой Бронной улице, не оказалось ни одного человека. В тот час, когда уж, кажется, и сил не было дышать,&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \n[24] \"      &lt;p&gt;когда солнце, раскалив &lt;place type='city'&gt;Москва&lt;/place&gt;, в сухом тумане валилось кудато за &lt;place type='street'&gt;Садовое кольцо&lt;/place&gt;, - никто не пришел под липы, никто&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                \n[25] \"      &lt;p&gt;не сел на скамейку, пуста была аллея.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \n[26] \"      &lt;p&gt;— Дайте нарзану, — попросил &lt;persName&gt;Берлиоз&lt;/persName&gt;.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n[27] \"      &lt;p&gt;— Нарзану нету, — ответила женщина в будочке и почемуто обиделась.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \n[28] \"      &lt;p&gt;— Пиво есть? —- сиплым голосом осведомился Бездомный.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \n[29] \"      &lt;p&gt;— Пиво привезут к вечеру, — ответила женщина.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \n[30] \"      &lt;p&gt;— А что есть? — спросил &lt;persName&gt;Берлиоз&lt;/persName&gt;.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \n[31] \"      &lt;p&gt;— Абрикосовая, только теплая, — сказала женщина.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \n[32] \"      &lt;p&gt;— Ну, давайте, давайте, давайте!..&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \n[33] \"      &lt;p&gt;Абрикосовая дала обильную желтую пену, и в воздухе запахло парикмахерской. Напившись, литераторы немедленно начали икать, расплатились и уселись на скамейке лицом к пруду и спиной к Бронной.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                            \n[34] \"      &lt;p&gt;Тут приключилась вторая странность, касающаяся одного &lt;persName&gt;Берлиоза&lt;/persName&gt;. Он внезапно перестал икать, сердце его стукнуло и на мгновенье куда-то провалилось, потом вернулось, но ступой иглой, засевшей в нем. Кроме того, Берлиоза охватил необоснованный, но столь сильный страх, что ему захотелось тотчас же бежать с &lt;place type='park'&gt;Патриарших&lt;/place&gt; без оглядки. Берлиоз тоскливо оглянулся, не понимая, что его напугало. Он побледнел, вытер лоб платком, подумал: «Что это со мной? Этого никогда не было... сердце шалит... я переутомился. Пожалуй, пора бросить все к черту и в Кисловодск…»&lt;/p&gt;\"\n[35] \"      &lt;p&gt;И тут знойный воздух сгустился перед ним, и соткался из этого воздуха прозрачный гражданин престранного вида.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \n[36] \"      &lt;!-- The following paragraphs continue in the same pattern, preserving the original text. --&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \n[37] \"      &lt;!-- Personal names such as Михайла Александровича Берлиоза, Иван Николаевич Понырев, Филипа Александрийского, Иосифа Флавия, etc., should be wrapped in &lt;persName&gt;. --&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                         \n[38] \"      &lt;!-- Places such as &lt;place type='city'&gt;Москва&lt;/place&gt;, &lt;place type='park'&gt;Патриаршие пруды&lt;/place&gt;, &lt;place type='street'&gt;Садовое кольцо&lt;/place&gt;, &lt;place type='city'&gt;Кисловодск&lt;/place&gt; should be marked similarly. --&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                           \n[39] \"      &lt;p&gt;— Фу ты черт! — воскликнул редактор, — ты знаешь, Иван, у меня сейчас едва удар от жары не сделался! Даже что-то вроде галлюцинации было, — он попытался усмехнуться, но в глазах его еще прыгала тревога, и руки дрожали.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                \n[40] \"      &lt;p&gt;Однако постепенно он успокоился, обмахнулся платком и, произнеся довольно бодро: «Ну-с, итак...» — повел речь, прерванную питьем абрикосовой.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \n[41] \"      &lt;p&gt;Речь эта, как впоследствии узнали, шла об Иисусе Христе.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \n[42] \"      &lt;p&gt;Дело в том, что редактор заказал поэту для очередной книжки журнала большую антирелигиозную поэму. Эту поэму &lt;persName&gt;Иван Николаевич&lt;/persName&gt; сочинил, и в очень короткий срок, но, к сожалению, ею редактора нисколько не удовлетворил.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                              \n[43] \"      &lt;p&gt;Очертил Бездомный главное действующее лицо своей поэмы, то есть Иисуса, очень черными красками, и тем не менее всю поэму приходилось, по мнению редактора, писать заново. И вот теперь редактор читал поэту нечто вроде лекции об Иисусе, с тем чтобы подчеркнуть основную ошибку поэта.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                  \n[44] \"      &lt;p&gt;Трудно сказать, что именно подвело Иван Николаевича — изобразительная ли сила его таланта или полное незнакомство с вопросом, по которому он собирался писать, - но Иисус в его изображении получился ну совершенно как живой, хотя и не привлекающий к себе персонаж.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                    \n[45] \"      &lt;!-- More content continues following the same structure... --&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \n[46] \"      &lt;p&gt;— А вы соглашались с вашим собеседником? — осведомился неизвестный, повернувшись вправо к Бездомному.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \n[47] \"      &lt;p&gt;— На все сто! — подтвердил тот, любя выражаться вычурно и фигурально.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \n[48] \"      &lt;p&gt;— Изумительно! — воскликнул непрошеный собеседник и, почему-то воровски оглянувшись и приглушив свой низкий голос, сказал: — Простите мою навязчивость, но я так понял, что вы, помимо всего прочего, еще и не верите в бога? — он сделал испуганные глаза и прибавил: — Клянусь, я никому не скажу.&lt;/p&gt;\"                                                                                                                                                                                                                                                                                                                      \n[49] \"      &lt;!-- The rest of the story continues verbatim. --&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \n[50] \"    &lt;/body&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \n[51] \"  &lt;/text&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \n[52] \"&lt;/TEI&gt; \"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \n[53] \"&lt;/text&gt;\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \n\n\n\nВыведем статистику по нашему xml-документу:\n\n\n\nКоличество абзацев: 39 \n\n\nКоличество упоминаний персонажей: 8 \n\n\nСписок персонажей: Михаил Александрович Берлиоз Иван Николаевич Понырев Берлиоз Берлиоз Берлиоза Иван Николаевич \n\n\nКоличество упоминаний мест: 5 \n\n\n\nА теперь выводим график частоты упоминания персонажей"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "index.html#текст-и-рисунки-восстановлены-по-книге-э.-щредингера",
    "href": "index.html#текст-и-рисунки-восстановлены-по-книге-э.-щредингера",
    "title": "Итоговый проект",
    "section": "",
    "text": "«Что такое жизнь с точки зрения физики?», вышедшей в 1947 г. в Москве в государственном издательстве Иностранной литературы. Текст ссылки"
  }
]